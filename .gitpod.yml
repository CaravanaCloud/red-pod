# gitpod.io/#github.com/CaravanaCloud/red-pod
image:
  file: .gitpod.Dockerfile

tasks:
  - name: MySQL
    command: |
      docker run -d --rm \
        --name mysql \
        --network=host \
        -e MYSQL_ROOT_PASSWORD=Masterkey123 \
        -e MYSQL_DATABASE=redpod\
        mysql:8
      gp sync-done mysql-up

  - name: Keycloak
    init: gp sync-await mysql-up
    command: |
      docker run --rm --name keycloak \
        --network=host \
        -e KEYCLOAK_ADMIN=admin \
        -e KEYCLOAK_ADMIN_PASSWORD=Masterkey123 \
        -e KC_DB=mysql \
        -e KC_DB_URL=jdbc:mysql://127.0.0.1:3306/redpod \
        -e KC_DB_USERNAME=root \
        -e KC_DB_PASSWORD=Masterkey123 \
        -e KC_HOSTNAME_STRICT=true \
        -e KC_HOSTNAME_STRICT_BACKCHANNEL=true \
        -e KC_LOG_LEVEL=info \
        quay.io/keycloak/keycloak:18.0.0 \
        start-dev
  

ports:
  - port: 3306
    onOpen: ignore
    visibility: public

  - port: 5000
    onOpen: ignore
    visibility: public

  - port: 8080
    onOpen: open-browser
    visibility: public

  - port: 8888
    onOpen: ignore
    visibility: public

vscode:
  extensions:
    - vscjava.vscode-java-pack
    - vscjava.vscode-java-debug
    - vscjava.vscode-java-dependency
    - vscjava.vscode-java-test
    - vscjava.vscode-maven
    - redhat.java
    - redhat.fabric8-analytics
    - ms-azuretools.vscode-docker
    - esbenp.prettier-vscode
#    - GitHub.copilot

